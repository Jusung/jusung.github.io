---
layout: post
title: "[Xcode] Remote Push ì‹œë®¬ë ˆì´ì…˜"
category: 
  - Xcode
tags: 
  - Xcode 11.4
comments: true
published: true
---

[Xcode 11.4](https://developer.apple.com/documentation/xcode_release_notes/xcode_11_4_beta_release_notes)ë¶€í„°  ì‹œë®¬ë ˆì´í„°ì—ì„œ [Remote Push Notification](https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/APNSOverview.html#//apple_ref/doc/uid/TP40008194-CH8-SW1)ì˜ ì‹œë®¬ë ˆì´ì…˜ì„ ì§€ì›í•©ë‹ˆë‹¤. ğŸ˜„

ì‹œë®¬ë ˆì´ì…˜ì€ ë‹¤ìŒê³¼ ê°™ì´ ë‘ê°€ì§€ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.

1. ì‹œë®¬ë ˆì´í„°ì— apns íŒŒì¼ì„ ì§ì ‘ ë“œë˜ê·¸ í•˜ëŠ” ë°©ë²•
2. CLIë¥¼ ì´ìš©í•˜ëŠ” ë°©ë²•

## ì¤€ë¹„

Remote Push Notificationë¥¼ ì‹œë®¬ë ˆì´ì…˜ í•˜ê¸° ìœ„í•´ì„œëŠ” ìš°ì„  ì‚¬ìš©ìì—ê²Œ **í‘¸ì‹œ ì•Œë¦¼ ì‚¬ìš© ê¶Œí•œì„ ìš”ì²­í•˜ê³  í—ˆê°€ë¥¼ ë°›ì•„ì•¼** í•©ë‹ˆë‹¤.

ê¶Œí•œ ìš”ì²­ì„ ìœ„í•´ `AppDelegate` íŒŒì¼ì˜ `didFinishLaunchingWithOptions` ë¸ë¦¬ê²Œì´íŠ¸ì— ê¶Œí•œ ìš”ì²­ ì½”ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

```swift
func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
   requestAuthorizationForRemotePushNotification()
   return true
}

// ì‚¬ìš©ìì—ê²Œ í‘¸ì‹œ ê¶Œí•œì„ ìš”ì²­
func requestAuthorizationForRemotePushNotification() {
    UNUserNotificationCenter.current()
        .requestAuthorization(options: [.alert, .sound, .badge]) { (granted, error) in
            print("Permission granted \(granted)")
    }
}
```

ì•±ì„ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ê¶Œí•œ ìš”ì²­ íŒì—…ì´ ë…¸ì¶œë˜ëŠ”ë°, í—ˆìš©(Allow)ì„ ì„ íƒí•´ Remote Pushë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•´ì¤ë‹ˆë‹¤.

![Request Permission]({{ site.baseurl }}/images/2020/permision request.png)

ì¤€ë¹„ëŠ” ëë‚¬ìŠµë‹ˆë‹¤. ì´ì œ ì‹œë®¬ë ˆì´ì…˜ì„ í•´ë³´ì£ .

## 1. ì‹œë®¬ë ˆì´í„°ì— apns íŒŒì¼ì„ ì§ì ‘ ë“œë˜ê·¸ í•˜ëŠ” ë°©ë²•

apns íŒŒì¼ì€ `json` í¬ë§·ì˜ í™•ì¥ìê°€  `apns`ì¸ íŒŒì¼ì…ë‹ˆë‹¤.

apnsì˜ payload í˜•ì‹ì„ ë”°ë¼ ìƒ˜í”Œ íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤. 

```
{
    "Simulator Target Bundle" : "com.joyfulpace.apnsTest",
    "aps" : {
        "alert" : {
            "title" : "ìµœê³ ì˜ iOS ê°œë°œíŒ€ ë§´ë²„",
            "body" : "ì‰˜ë“ , ì œì´ë“ , í”Œë¼, ë„¤ì˜¤, ì¤„ë¦¬, ì…€ë¦¬ë‚˜, ë£¨í‚¤, í—¤ì´, ì„¸ì¼ëŸ¬, ë°”íŠ¸, ìŠ¤í‹°ë¸Œ, ê°€ë¸Œë¦¬ì—˜, ë”˜, ì¡°ë‚˜ë‹¨, í† ë¯¸",
        },
    },
}
```

paylaodì˜ keyëŠ” ë‹¤ìŒê³¼ ê°™ì´ í¬ê²Œ ë‘ ë¶€ë¶„ìœ¼ë¡œ êµ¬ì„±ë¼ ìˆìŠµë‹ˆë‹¤.

1.  **Simulator Target Bundle** : ì‹œë®¬ë ˆì´í„°ì— ì„¤ì¹˜ëœ í…ŒìŠ¤íŠ¸ ì•±ì˜ bundleID
2. **aps** : Remote Push Notification ì‚¬ìš©ì„ ìœ„í•´ ì§€ì •ëœ payload (ë” ë§ì€ payload keyëŠ” [ì´ê³³](https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/CreatingtheNotificationPayload.html#//apple_ref/doc/uid/TP40008194-CH10-SW1)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)

ì•Œë§ì€ ì•± bundleIDì™€ payloadë¥¼ ë„£ê³  íŒŒì¼ì„ ì €ì¥í•©ë‹ˆë‹¤. ì €ëŠ” ì´ íŒŒì¼ì„ `test.apns` ë¡œ ì €ì¥í•˜ê² ìŠµë‹ˆë‹¤.

ì´ì œ ì´ íŒŒì¼ì„ ì‹œë®¬ë ˆì´í„°ì— ë“œë˜ê·¸ í•´ë³´ê² ìŠµë‹ˆë‹¤.

![Drag]({{ site.baseurl }}/images/2020/remotepush test drag.gif)

ì‹œë®¬ë ˆì´ì…˜ì´ ì˜ ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## 2. CLIë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•

í„°ë¯¸ë„ì—ì„œë„ í‘¸ì‹œ ì‹œë®¬ë ˆì´ì…˜ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì‹œë®¬ë ˆì´ì…˜ì—ëŠ” `xcrun` ëª…ë ¹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

ëª…ë ¹ì–´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```
xcrun simctl push EEDF7FDD-6C34-4DB6-8A3B-43B71769E2D8 com.joyfulpace.apnsTest test.apns
```

**[xcrun ëª…ë ¹]**

```
$ xcrun simctl push --help
Send a simulated push notification
Usage: simctl push <device> [<bundle identifier>] (<json file> | -)

	bundle identifier
	     The bundle identifier of the target application
	     If the payload file contains a 'Simulator Target Bundle' top-level key this parameter may be omitted.
	     If both are provided this argument will override the value from the payload.
	json file
	     Path to a JSON payload or '-' to read from stdin. The payload must:
	       - Contain an object at the top level.
	       - Contain an 'aps' key with valid Apple Push Notification values.
	       - Be 4096 bytes or less.

Only application remote push notifications are supported. VoIP, Complication, File Provider, and other types are not supported.
```

íŒŒë¼ë¯¸í„°ì—ì„œ ê°ì ì…ë ¥í•´ ì¤˜ì•¼í•˜ëŠ” ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1. **device** : ì‹œë®¬ë ˆì´í„°ì˜ Identifierì…ë‹ˆë‹¤. (EEDF7FDD-6C34-4DB6-8A3B-43B71769E2D8)
2. **bundle identifier** : ìì‹ ì˜ ì•±ì˜ ë²ˆë“¤ IDë¥¼ ì ì–´ì¤ë‹ˆë‹¤.
3. **json file** : í™•ì¥ìê°€ apnsì—¬ë„ ìƒê´€ ì—†ìŠµë‹ˆë‹¤.

ì‹œë®¬ë ˆì´í„°ì˜ IdentifierëŠ” ë‹¤ìŒê³¼ ê°™ì´ `xcrun simctl list devices` ëª…ë ¹ìœ¼ë¡œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë¦¬ìŠ¤íŠ¸ ì¤‘ì—ì„œ í˜„ì¬ ì‚¬ìš©ì¤‘ì¸ ì‹œë®¬ë ˆì´í„°ëŠ” `Booted`ë¼ê³  ìƒíƒœê°€ í‘œì‹œë©ë‹ˆë‹¤.

ì‹œë®¬ë ˆì´í„° ê¸°ì¢…ì´ ë§ê³  ìƒíƒœê°€ `Booted`ì¸ ì‹œë®¬ë ˆì´í„° identifierë¥¼ ë³µì‚¬í•´ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

ë‹¤ìŒê³¼ ê°™ì´ `grep Booted`ë¡œ listì˜ ê²°ê³¼ë¥¼ í•„í„°ë§í•´ ë³´ë©´ í•œë²ˆì— ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
 
```
$ xcrun simctl list devices | grep Booted
    iPhone 11 Pro Max (EEDF7FDD-6C34-4DB6-8A3B-43B71769E2D8) (Booted) 
```

CLIë¥¼ ì‚¬ìš©í•  ê²½ìš° ë‹¤ìŒê³¼ ê°™ì´ apns íŒŒì¼ì— `Simulator Target Bundle` ë¶€ë¶„ì„ ìƒëµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
bundleIDê°€ CLIì˜ íŒŒë¼ë¯¸í„°ì— ë“¤ì–´ê°€ê¸° ë•Œë¬¸ì´ì£ .

```
{
    "aps" : {
        "alert" : {
            "title" : "ìµœê³ ì˜ iOS ê°œë°œíŒ€ ë§´ë²„",
            "body" : "ì‰˜ë“ , ì œì´ë“ , í”Œë¼, ë„¤ì˜¤, ì¤„ë¦¬, ì…€ë¦¬ë‚˜, ë£¨í‚¤, í—¤ì´, ì„¸ì¼ëŸ¬, ë°”íŠ¸, ìŠ¤í‹°ë¸Œ, ê°€ë¸Œë¦¬ì—˜, ë”˜, ì¡°ë‚˜ë‹¨, í† ë¯¸",
        },
    },
}
```

ì‹¤í–‰í•´ ë³´ê² ìŠµë‹ˆë‹¤. ì˜ ë˜ë„¤ìš”.

![CLI]({{ site.baseurl }}/images/2020/remotepush test cli.png)
## ì²¨ë¶€3

ì´ìƒ ì‹œë®¬ë ˆì´í„°ì—ì„œ Remote Push Notificationì„ ì‹œë®¬ë ˆì´ì…˜ í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ ë³´ì•˜ìŠµë‹ˆë‹¤. ğŸ˜„